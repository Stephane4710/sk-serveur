<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mes Fonds | SK Serveur</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#0b0f17;
    color:#fff;
}
.container{
    width:90%;
    max-width:1100px;
    margin:30px auto;
}

/* HEADER */
.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:30px;
}
.header h1{margin:0;letter-spacing:3px;}
.back-btn{
    text-decoration:none;
    color:#fff;
    padding:10px 14px;
    border-radius:10px;
    background:rgba(255,255,255,0.08);
}

/* SOLDE */
.wallet{
    background:linear-gradient(135deg,#1e293b,#0f172a);
    padding:25px;
    border-radius:18px;
    margin-bottom:30px;
}
.wallet .amount{
    font-size:36px;
    font-weight:bold;
    color:#4e8cff;
}

/* SWITCH */
.pay-switch{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
    margin-bottom:25px;
}
.pay-switch button{
    padding:14px;
    border:none;
    border-radius:14px;
    font-weight:bold;
    cursor:pointer;
    background:linear-gradient(135deg,#4e8cff,#2bd3ff);
    color:#fff;
}

/* BOX */
.form-box{
    background:rgba(255,255,255,0.06);
    padding:25px;
    border-radius:18px;
    margin-bottom:30px;
}

/* FORM */
.form-group{margin-bottom:18px;}
.form-group label{
    display:block;
    margin-bottom:6px;
    color:#b0b8c6;
}
.form-group input,
.form-group select{
    width:100%;
    padding:12px;
    border-radius:10px;
    border:none;
    background:#0f172a;
    color:#fff;
}

/* NUMERO / ADRESSE */
.pay-number{
    margin-top:12px;
    padding:12px;
    background:#020617;
    border-radius:10px;
    color:#4e8cff;
    font-weight:bold;
    cursor:pointer;
    text-align:center;
}

/* SUBMIT */
.submit-btn{
    width:100%;
    padding:14px;
    border:none;
    border-radius:12px;
    background:linear-gradient(135deg,#22c55e,#16a34a);
    color:#000;
    font-weight:bold;
    cursor:pointer;
}

/* HISTORIQUE */
.tx{
    background:rgba(255,255,255,0.06);
    padding:15px;
    border-radius:14px;
    margin-bottom:12px;
    display:flex;
    justify-content:space-between;
}
.status{padding:6px 10px;border-radius:10px;font-weight:bold;}
.attente{background:#facc15;color:#000;}
.valide{background:#22c55e;color:#000;}
.refuse{background:#ef4444;color:#fff;}

@media(max-width:768px){
    .pay-switch{grid-template-columns:1fr;}
}
</style>
</head>

<body>
<div class="container">

<!-- HEADER -->
<div class="header">
    <h1>MES FONDS</h1>
    <a href="{% url 'accueil' %}" class="back-btn">‚Üê Retour</a>
</div>

<!-- SOLDE -->
<div class="wallet">
    <h2>Solde actuel</h2>
    <div class="amount">{{ wallet.solde }} FCFA</div>
</div>

<!-- SWITCH -->
<div class="pay-switch">
    <button type="button" onclick="showMobile()">üì± Mobile Money</button>
    <button type="button" onclick="showUSDT()">üî• USDT</button>
</div>

<!-- MOBILE -->
<div id="mobile-box" class="form-box">
    <h3>üì≤ D√©p√¥t Mobile Money</h3>

    <div class="form-group">
        <label>Choisir le r√©seau</label>
        <select onchange="selectMethode(this)">
            <option value="">-- S√©lectionner --</option>
            {% for p in payment_configs %}
                {% if p.methode in "wave mtn orange" %}
                <option value="{{ p.methode }}" data-num="{{ p.numero }}">
                    {{ p.get_methode_display }}
                </option>
                {% endif %}
            {% endfor %}
        </select>
    </div>

    <div id="mobileNumber" class="pay-number" style="display:none"></div>
</div>

<!-- USDT -->
<div id="usdt-box" class="form-box" style="display:none">
    <h3>üî• D√©p√¥t USDT</h3>

    <div class="form-group">
        <label>Choisir le r√©seau</label>
        <select onchange="selectMethode(this)">
            <option value="">-- S√©lectionner --</option>
            {% for p in payment_configs %}
                {% if "usdt" in p.methode %}
                <option value="{{ p.methode }}" data-num="{{ p.numero }}">
                    {{ p.get_methode_display }}
                </option>
                {% endif %}
            {% endfor %}
        </select>
    </div>

    <div id="usdtAddress" class="pay-number" style="display:none"></div>
</div>

<!-- FORM -->
<div class="form-box">
    <h3>Envoyer la demande</h3>

    <form method="post" action="{% url 'ajouter_fonds' %}">
        {% csrf_token %}

        <!-- IMPORTANT : methode envoy√©e -->
        <input type="hidden" name="methode" id="methodeInput">

        <div class="form-group">
            <label>Montant</label>
            <input type="number" name="montant" required>
        </div>

        <div class="form-group">
            <label>R√©f√©rence / TXID</label>
            <input type="text" name="reference" required>
        </div>

        <button class="submit-btn">Envoyer</button>
    </form>
</div>

<!-- HISTORIQUE -->
<div class="form-box">
    <h3>Historique</h3>
    {% for tx in transactions %}
    <div class="tx">
        <div>
            <strong>{{ tx.montant }} FCFA</strong><br>
            <small>{{ tx.get_methode_display }} ‚Ä¢ {{ tx.reference }}</small>
        </div>
        <div class="status {{ tx.statut }}">{{ tx.get_statut_display }}</div>
    </div>
    {% empty %}
    <p>Aucune transaction</p>
    {% endfor %}
</div>

</div>

<script>
function showMobile(){
    document.getElementById("mobile-box").style.display="block";
    document.getElementById("usdt-box").style.display="none";
}
function showUSDT(){
    document.getElementById("mobile-box").style.display="none";
    document.getElementById("usdt-box").style.display="block";
}

function selectMethode(el){
    const methode = el.value;
    const numero = el.selectedOptions[0].dataset.num || "";
    document.getElementById("methodeInput").value = methode;

    let box = methode.includes("usdt")
        ? document.getElementById("usdtAddress")
        : document.getElementById("mobileNumber");

    box.style.display="block";
    box.innerText = (methode.includes("usdt") ? "üîó " : "üìû ") + numero + " (cliquer pour copier)";
    box.onclick = () => copyText(numero, box);
}

function copyText(text, el){
    navigator.clipboard.writeText(text).then(()=>{
        const old = el.innerText;
        el.innerText = "‚úÖ Copi√© !";
        setTimeout(()=> el.innerText = old, 1200);
    });
}
</script>

</body>
</html>
